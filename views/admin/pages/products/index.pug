extends ../../layouts/default.pug
include ../../mixins/alert.pug
include ../../mixins/moment.pug

block main 
  +alert-success(5000)
  +alert-error(5000)

  if(role.permissions.includes("products_view"))



    h1 Trang sản phẩm
    //- - if (messages.success)
    //-   .message.info
    //-     div(
    //-       class="alert alert-success"  
    //-       data-time="5000"
    //-       show-alert
    //-     ) #{messages.success} <span close-alert>X</span>
        

    .card.mb-3
      .card-header Bộ lọc và Tìm kiếm
      .card-body
        .row
          .col-6
            include ../../mixins/filter-status.pug
            +filter-status(filterStatus)
          .col-6 
            include ../../mixins/search.pug
            +search(keyword)
    .card.mb-3
    .card-header Sắp xếp
    .card-body
      .row
        .col-4
          include ../../mixins/sort.pug
          +sort()


    .card.mb-3
      .card-header Danh sách sản phẩm
      .card-body
        //- form(action=`${prefixAdmin}/products/change-multi?_method=PATCH` method="POST" form-change-multi)
        //-   .d-flex.align-items-start
        //-     .form-group
        //-       select(name="type" class="form-select")
        //-         option(value="active") Hoạt động
        //-         option(value="inactive") Dừng hoạt động
        //-     .form-group
        //-       input(type="text" name="ids" value="" class="form-control d-none")
        //-     button(type="submit" class="btn btn-primary") Áp dụng
        include ../../mixins/form-change-multi.pug
        .row
          .col-8
            if(role.permissions.includes("products_edit"))
              +form-change-multi(`${prefixAdmin}/products/change-multi?_method=PATCH`)
          .col-4
            if(role.permissions.includes("products_create"))
              a(href=`${prefixAdmin}/products/create` class="btn btn-outline-success  ") + Thêm mới

    


        table(
          class="table table-hover table-sm" checkbox-multi
        )
          thead 
            tr 
              th
                input(type="checkbox" name="checkAll")
              th STT 
              th Hình ảnh 
              th Tiêu đề
              th Giá
              th Vị trí
              th Trạng thái
              th Người tạo
              th Người cập nhật
              th Hành động
          tbody 
            each item, index in products
              tr 
                td
                  input(
                    type = "checkbox"
                    name = "id"
                    value = item.id
                  )
                td #{pagination.limitItems*(pagination.currentPage - 1)+(index+1)}
                td 
                  img(src=item.thumbnail)
                td #{item.title}
                td #{item.price}$
                td
                  input(
                    type = "number"
                    name = "position"
                    value = item.position
                    style = "width: 60px"
                    min ="1"
                  )
                td 
                  if(role.permissions.includes("products_edit"))
                    if item.status == "active"
                      a.btn.btn-success(href="javascript:;" data-status=item.status data-id=item.id button-change-status) Hoạt động
                    else
                      a.btn.btn-danger(href="javascript:;" data-status=item.status data-id=item.id button-change-status) Ngừng hoạt động
                td 
                  p #{item.accountFullName}
                  p 
                    +formatDateTime(item.createdBy.createdAt)
                  //- p #{moment(item.createdBy.createdAt).format("DD/MM/YYYY HH:mm:ss")}
                td 
                  - const updatedBy = item.updatedBy[item.updatedBy.length - 1];
                  if(updatedBy)
                    p #{item.accountFullName}
                    p 
                      +formatDateTime(updatedBy.updatedAt)
                td 
                  a( 
                    href = `${prefixAdmin}/products/detail/${item.id}`
                    class="btn btn-secondary btn-sm") Chi tiết
                  if(role.permissions.includes("products_edit"))
                    a( 
                      href = `${prefixAdmin}/products/edit/${item.id}`
                      class="btn btn-warning btn-sm") Sửa
                  if(role.permissions.includes("products_delete"))
                    button(class="btn btn-danger btn-sm ml-1" data-id=item.id button-delete) Xóa
    include ../../mixins/pagination.pug
    +pagination(pagination)

    form(
      action=``
      method="POST"
      id = "formChangeStatus"
      data-path = `${prefixAdmin}/products/change-status`
    )

    form(
      action=``
      method="POST"
      id = "formDeleteItem"
      data-path = `${prefixAdmin}/products/delete`
    )

  script(src="/admin/js/product.js")
