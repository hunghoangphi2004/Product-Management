extends ../../layouts/default.pug
include ../../mixins/moment.pug

block main 
  if(role.permissions.includes("users_view"))
    h1(class="mb-4") Danh sách tài khoản

    .card.mb-3
      .card-header Bộ lọc và Tìm kiếm
      .card-body
        .row
          .col-6
            include ../../mixins/filter-status.pug
            +filter-status(filterStatus)
          .col-6 
            include ../../mixins/search.pug
            +search(keyword)
            

    .card.mb-3
      .card-header Danh sách
      .card-body

    table(
          class="table table-hover table-sm" checkbox-multi
        )
          thead 
            tr 
              th STT 
              th Hình ảnh 
              th Họ tên
              th Email
              th Trạng thái
              th Ngày tạo
              th Hành động
          tbody 
            each item, index in records
              tr 
                td #{index+1}
                td 
                  img(
                    src=item.avatar 
                    alt=`${item.fullname}`
                    style="width:200px; height:200px; object-fit:cover;"
                  )
                td #{item.fullname}
                td #{item.email}
                td 
                  if(role.permissions.includes("users_edit"))
                    if item.status == "active"
                      a.btn.btn-success(href="javascript:;" data-status=item.status data-id=item.id button-change-status) Hoạt động
                    else
                      a.btn.btn-danger(href="javascript:;" data-status=item.status data-id=item.id button-change-status) Ngừng hoạt động
                td 
                  p 
                    +formatDateTime(item.createdAt)
                td 
                  a( 
                    href = `${prefixAdmin}/users/detail/${item.id}`
                    class="btn btn-secondary btn-sm") Chi tiết
                  if(role.permissions.includes("users_delete"))
                    button(class="btn btn-danger btn-sm ml-1" data-id=item.id button-delete) Xóa
    include ../../mixins/pagination.pug
    +pagination(pagination)
    form(
      action=``
      method="POST"
      id = "formChangeStatus"
      data-path = `${prefixAdmin}/users/change-status`
    )

    form(
      action=``
      method="POST"
      id = "formDeleteItem"
      data-path = `${prefixAdmin}/users/delete`
    )

  script(src="/admin/js/user.js")