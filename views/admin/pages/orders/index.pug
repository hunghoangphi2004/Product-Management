extends ../../layouts/default.pug
include ../../mixins/moment.pug

block main 
  
  if(role.permissions.includes("orders_view"))
    h1(class="mb-4") Danh sách tài khoản

    .card.mb-3
      .card-header Bộ lọc và Tìm kiếm
      .card-body
        .row
          .col-6
            include ../../mixins/filter-status.pug
            +filter-status(filterStatus)
          .col-6 
            include ../../mixins/search.pug
            +search(keyword)
            

    .card.mb-3
      .card-header Danh sách
      .card-body
        .row
          .col-8
          .col-4.text-right
    table(
          class="table table-hover table-sm" checkbox-multi
        )
          thead 
            tr 
              th STT 
              th Họ tên
              th Số điện thoại
              th Địa chỉ
              th Trạng thái
              th Ngày tạo
              th Người cập nhật
              th Thao tác
          tbody 
            each item, index in orders
              tr 
                td #{index+1}
                td #{item.userInfo.fullname}
                td #{item.userInfo.phone}
                td #{item.userInfo.address}
                td 
                  if(role.permissions.includes("ordes_edit"))
                    if item.status == "paid"
                      a.btn.btn-success(href="javascript:;" data-status=item.status data-id=item.id button-change-status) Đã thanh toán
                    else
                      a.btn.btn-danger(href="javascript:;" data-status=item.status data-id=item.id button-change-status) Chưa thanh toán
                td 
                  +formatDateTime(item.createdAt)
                td 
                  - const updatedBy = item.updatedBy[item.updatedBy.length - 1];
                  if(updatedBy)
                    p #{updatedBy.accountFullName}
                    p 
                      +formatDateTime(updatedBy.updatedAt)
                td 
                  a( 
                    href = `${prefixAdmin}/orders/detail/${item.id}`
                    class="btn btn-secondary btn-sm") Chi tiết
                  if(role.permissions.includes("orders_delete"))
                    button(class="btn btn-danger btn-sm ml-1" data-id=item.id button-delete) Xóa
    include ../../mixins/pagination.pug
    +pagination(pagination)
    form(
      action=``
      method="POST"
      id = "formChangeStatus"
      data-path = `${prefixAdmin}/orders/change-status`
    )

    form(
      action=``
      method="POST"
      id = "formDeleteItem"
      data-path = `${prefixAdmin}/orders/delete`
    )
  else 

    script(src="/admin/js/order.js")